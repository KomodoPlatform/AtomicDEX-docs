<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Smart Contract: Gateways | Komodo Developer Documentation</title>
    <meta name="description" content="Documentation for developers building on Komodo">
    
    
    <link rel="preload" href="/komodo-docs-vuepress/assets/css/0.styles.5978d221.css" as="style"><link rel="preload" href="/komodo-docs-vuepress/assets/js/app.98eba040.js" as="script"><link rel="preload" href="/komodo-docs-vuepress/assets/js/14.0559a178.js" as="script"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/10.fa46c12f.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/11.726a5c6f.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/12.7addabd9.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/13.534e5eab.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/15.dffcdf7f.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/16.7a650e46.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/17.3f20971f.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/18.7f8ee2ce.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/19.de14fddf.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/2.a3ae82a5.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/20.7c7a0ec4.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/21.c12abd42.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/22.ece0e705.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/23.53f9345e.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/24.c662a9ee.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/25.090afdcb.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/26.4d5afbf3.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/27.1d434e56.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/28.fc6d6dbd.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/29.fcbd228c.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/3.e79f4ad4.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/30.545998a0.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/4.94a2876e.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/5.f9b44f50.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/6.6ff6b9c0.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/7.8eca54e4.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/8.0ac769f5.js"><link rel="prefetch" href="/komodo-docs-vuepress/assets/js/9.537f8c75.js">
    <link rel="stylesheet" href="/komodo-docs-vuepress/assets/css/0.styles.5978d221.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/komodo-docs-vuepress/" class="home-link router-link-active"><!----> <span class="site-name">Komodo Developer Documentation</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/komodo-docs-vuepress/000-start-here/_001-introduction.html" class="nav-link">Start Here</a></div><div class="nav-item"><a href="https://komodoplatform.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  KomodoPlatform.com
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/komodo-docs-vuepress/000-start-here/_001-introduction.html" class="nav-link">Start Here</a></div><div class="nav-item"><a href="https://komodoplatform.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  KomodoPlatform.com
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Start Here</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Installation and Setup</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>CryptoConditions (Smart Contract Templates)</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/komodo-docs-vuepress/010-cryptoconditions/_101-cryptoconditions-instructions.html" class="sidebar-link">Instructions for CryptoConditions</a></li><li><a href="/komodo-docs-vuepress/010-cryptoconditions/_110-cc-channels.html" class="sidebar-link">Channels</a></li><li><a href="/komodo-docs-vuepress/010-cryptoconditions/_120-cc-dice.html" class="sidebar-link">Dice</a></li><li><a href="/komodo-docs-vuepress/010-cryptoconditions/_130-cc-faucet.html" class="sidebar-link">Faucet</a></li><li><a href="/komodo-docs-vuepress/010-cryptoconditions/_133-cc-gateways.html" class="active sidebar-link">Gateways</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/komodo-docs-vuepress/010-cryptoconditions/_133-cc-gateways.html#create-an-oracle-for-storing-blockheader-data-on-the-blockchain" class="sidebar-link">Create an Oracle for Storing &quot;Blockheader Data&quot; on the Blockchain</a></li><li class="sidebar-sub-header"><a href="/komodo-docs-vuepress/010-cryptoconditions/_133-cc-gateways.html#assemble-the-dapp" class="sidebar-link">Assemble the dApp</a></li><li class="sidebar-sub-header"><a href="/komodo-docs-vuepress/010-cryptoconditions/_133-cc-gateways.html#using-the-gateway" class="sidebar-link">Using the Gateway</a></li></ul></li><li><a href="/komodo-docs-vuepress/010-cryptoconditions/_135-cc-oracles.html" class="sidebar-link">Oracles</a></li><li><a href="/komodo-docs-vuepress/010-cryptoconditions/_140-cc-rewards.html" class="sidebar-link">Rewards</a></li><li><a href="/komodo-docs-vuepress/010-cryptoconditions/_150-cc-tokens.html" class="sidebar-link">Tokens</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Essential RPC Calls</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="smart-contract-gateways"><a href="#smart-contract-gateways" aria-hidden="true" class="header-anchor">#</a> Smart Contract: Gateways</h1> <p>The idea of the <code>gateways</code> smart contract is to facilitate, manage, and trade tokenized representations of foreign blockchain assets.</p> <p>For example, a user is able to deposit their real-world BTC into a monitored address on the Bitcoin blockchain. Then, on the <code>gateways</code> asset chain, the ownership of this BTC is tokenized. Only the owner of the token has the right to withdraw the BTC to a chosen address. The user that made the deposit can use the token either for asset trading, or for other creative purposes.</p> <p>This allows the <code>gateways</code>-enabled asset chain to feature secure, on-chain, high-speed trading.</p> <p>Using an established <code>gateways</code> smart contract is not considered difficult. However, setting up the <code>gateways</code> requires the user to closely follow several detailed steps.</p> <h3 id="examples"><a href="#examples" aria-hidden="true" class="header-anchor">#</a> Examples:</h3> <p><strong>GatewaysCC</strong> usage</p> <ul><li>Prepare a special oracle, having the data type <code>Ihh</code>; this oracle will retrieve information regarding Komodo's chainstate using the <strong>oraclefeed dApp</strong></li> <li>Bind the tokens and the oracle to our gateway</li> <li>Deposit KMD</li> <li>Exchange it with other tokens on-chain</li> <li>Use the tokens to withdraw the KMD</li></ul> <p>Please ensure that you have the KMD main chain downloaded and synced before continuing further in the guide.</p> <p>Also, please open an empty text file and save all output transaction ids and hex-encoded data from each step. You will need the information at various stages.</p> <h3 id="examples-2"><a href="#examples-2" aria-hidden="true" class="header-anchor">#</a> Examples:</h3> <h3 id="examples-3"><a href="#examples-3" aria-hidden="true" class="header-anchor">#</a> Examples:</h3> <p><strong>tokenid</strong>.</p> <p>Wait to ensure that the <code>tokenid</code> transaction is successfully notarized.</p> <p><code>./komodo-cli -ac_name=HELLOWORLD getinfo</code></p> <p>Watch for the notarization count to increase.</p> <p>Check that the mempool does not have your <code>tokenid</code> transaction in it.</p> <p><code>./komodo-cli -ac_name=HELLOWORLD getrawmempool</code></p> <p>You should not see your <code>tokenid</code> transaction in the returned response.</p> <p>You may also check the info in your token:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD tokeninfo YOUR_TOKEN_ID</code></p> <p>You may also check the balance for a specific pubkey:</p> <p>(If you have not transferred any of the tokens, then the entire supply should be within your own pubkey.)</p> <p><code>./komodo-cli -ac_name=HELLOWORLD tokenbalance TOKEN_ID PUBKEY</code></p> <h3 id="examples-4"><a href="#examples-4" aria-hidden="true" class="header-anchor">#</a> Examples:</h3> <p><strong>GatewaysPubkey</strong>:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD gatewaysaddress</code></p> <p>This will return the gateways pubkey. ===?===</p> <p>Then convert 100% of your KMD-token supply to the GatewayCC using the special <code>tokenconvert</code> call. Use the unique evalcode for <code>GatewaysCC</code> as the first parameter: <code>241</code></p> <p>You must set the supply in the number of tokens for this command. For example, if you used <code>1</code> coin from the parent chain to create <code>100000000</code> tokens, you now use <code>100000000</code> as the argument to indicate the total supply.</p> <p><code>./komodo-cli -ac_name=HELLOWORLD tokenconvert 241 YOUR_TOKEN_ID GATEWAYS_PUBKEY TOTAL_SUPPLY</code></p> <p>The above command will output a <strong>hex</strong> value, which you now broadcast using <code>sendrawtransaction</code>:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD sendrawtransaction HEX_DATA_HERE</code></p> <h3 id="examples-5"><a href="#examples-5" aria-hidden="true" class="header-anchor">#</a> Examples:</h3> <h2 id="create-an-oracle-for-storing-blockheader-data-on-the-blockchain"><a href="#create-an-oracle-for-storing-blockheader-data-on-the-blockchain" aria-hidden="true" class="header-anchor">#</a> Create an Oracle for Storing &quot;Blockheader Data&quot; on the Blockchain</h2> <p>To add external data to the blockchain, we use the <a href="#smart-contract-oracles"><code>oracles</code></a> smart contract.</p> <p>We have to create an oracle with an identical name, ie. <code>KMD</code>, and the data format must start with <code>Ihh</code> (height, blockhash, merkleroot):</p> <p><code>./komodo-cli -ac_name=HELLOWORLD oraclescreate KMD blockheaders Ihh</code></p> <p>Broadcast the returned HEX data:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD sendrawtransaction HEX_DATA_HERE</code></p> <p>This returns a transaction id, which is the <strong>oracleid</strong>.</p> <p>Register as a publisher for the oracle using <a href="#oraclesregister"><code>oraclesregister</code></a>:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD oraclesregister ORACLE_ID DATA_FEE_IN_SATOSHIS</code></p> <p>Broadcast the returned HEX value:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD sendrawtransaction HEX_DATA_HERE</code></p> <p>Then you have to subscribe to it for getting the UTXOs for data publishing. The number of data publishing transactions you can perform in a block is equal to the number of active subscriptions there are.</p> <p>Get the <strong>data-publisher's pubkey</strong> from the <code>oracesinfo</code> call:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD oraclesinfo ORACLE_ID</code></p> <p><strong>oracleid</strong>.</p> <p>Register as a publisher for the oracle using <a href="#oraclesregister"><code>oraclesregister</code></a>:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD oraclesregister ORACLE_ID DATA_FEE_IN_SATOSHIS</code></p> <p>Broadcast the returned HEX value:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD sendrawtransaction HEX_DATA_HERE</code></p> <p>Then you have to subscribe to it for getting the UTXOs for data publishing. The number of data publishing transactions you can perform in a block is equal to the number of active subscriptions there are.</p> <p>Get the <strong>data-publisher's pubkey</strong> from the <code>oracesinfo</code> call:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD oraclesinfo ORACLE_ID</code></p> <blockquote><p>Sample output:</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>    {
        &quot;result&quot;: &quot;success&quot;,
        &quot;txid&quot;: &quot;46e2dc958477160eb37de3a1ec1bb18899d77f5b47bd52b8a6f7a9ce14729157&quot;,
        &quot;name&quot;: &quot;KMD&quot;,
        &quot;description&quot;: &quot;blockheaders&quot;,
        &quot;format&quot;: &quot;Ihh&quot;,
        &quot;marker&quot;: &quot;RNFz9HAuzXhAjx6twEJzcHXconzChfiNM6&quot;,
        &quot;registered&quot;: [
            {
                &quot;publisher&quot;: &quot;03810d28146f60a42090991b044fe630d1664f3f8f46286c61e7420523318047b5&quot;,
                &quot;baton&quot;: &quot;RWg43P8s8RtJatAGNa2kV8N2abhQqH93w9&quot;,
                &quot;batontxid&quot;: &quot;99dd11f4eac1369f3fe8c6428f49e63da26e1b493f69b5bde29edbfbd06eb785&quot;,
                &quot;lifetime&quot;: &quot;0.00000000&quot;,
                &quot;funds&quot;: &quot;0.00000000&quot;,
                &quot;datafee&quot;: &quot;0.01000000&quot;
            }
        ]
    }
</code></pre></div><p>Sample output for the above call can be seen on the right:</p> <p>The property, <code>&quot;publisher&quot;</code>, in the entry, <code>&quot;registered&quot;</code>, of the json object is the data-publisher's <code>pubkey</code>, also called the <code>publisherpubkey</code>.</p> <p>Now subscribe with a custom fee in the asset-chain coins:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD oraclessubscribe ORACLE_ID PUBLISHERPUBKEY DATA_FEE_IN_COINS</code></p> <p>Broadcast the HEX using <code>sendrawtransaction</code>:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD sendrawtransaction HEX_DATA_HERE</code></p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>It may be useful to execute the <b>oraclessubscribe</b> and <b>sendrawtransaction</b> methods with a few different values, in case you need to broadcast more than one sample of data in each block. In our example, you want to publish data for more than one KMD-height per block.</p></div> <p>Check the information about the oracle:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD oraclesinfo ORACLE_ID</code></p> <p>Please keep in mind the flow of the oracle data fees :</p> <ul><li>The publisher sets the <code>datafee</code> in the <code>oraclesregister</code> method</li> <li>Anyone can subscribe to this publisher on this oracle, committing their desired amount to the publisher</li> <li>The publisher may withdraw their fee from the total amount each time the publisher uses <code>oraclesdata</code> to publish data</li></ul> <h3 id="examples-6"><a href="#examples-6" aria-hidden="true" class="header-anchor">#</a> Examples:</h3> <p><strong>bindtxid</strong>. This is the id of the gateway at <code>MYPUBKEY</code>.</p> <p>If the command is successful, you may review your new gateway using <a href="#gatewaysinfo"><code>gatewaysinfo</code></a>:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD gatewaysinfo BINDTXID</code></p> <p>Verify that the returned <strong>tokenid</strong> and <strong>oracleid</strong> match those provided earlier.</p> <h3 id="examples-7"><a href="#examples-7" aria-hidden="true" class="header-anchor">#</a> Examples:</h3> <h2 id="assemble-the-dapp"><a href="#assemble-the-dapp" aria-hidden="true" class="header-anchor">#</a> Assemble the dApp</h2> <p>Once compiled, the oracle dApp will handle the transfer of merkleroot data to our oracle.</p> <p>Change into the <code>komodod</code> and <code>komodo-cli</code> directory:</p> <p><code>cd ~/komodo/src/</code></p> <p>Compile the dApp:</p> <p><code>gcc cc/dapps/oraclefeed.c -lm -o oraclefeed</code></p> <p>Run the dApp:</p> <p><code>./oraclefeed $ACNAME $ORACLETXID $MYPUBKEY $FORMAT $BINDTXID &amp;</code></p> <p><code>$ACNAME</code>: The name of our asset chain; in our example it is HELLOWORLD</p> <p><code>$ORACLETXID</code>: The ID of the oracle</p> <p><code>$MYPUBKEY</code>: Your desired pubkey</p> <p><code>$FORMAT</code>: <code>Ihh</code></p> <p><code>$BINDTXID</code>: The ID of the gateway bind, <strong>bindtxid</strong></p> <p><strong>bindtxid</strong></p> <blockquote><p>Sample Response:</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>(succesfull oraclization of KMD heights):
KMD ht.1023334 &lt;- 669d0f009eaf85900be0d54fa1b5f455d49edfc1d9dcfe71c43b8be19b7927dda3ecd20c0175bc7b8eb98d857baeeef6a18fc7d6b58bd34b4eb00beaa18c5842bbe5566a
broadcast HELLOWORLD txid.(9484283d8d4bf28b4053e21e7b7e8210eb59c41668e9c7280c4e6c4fbf61579a)
KMD ht.1023335 &lt;- 679d0f00173d5dc169a64bba92e5765fde848cc620a700295ecce8837cb2a13b05000000ed71033532278f72c8f64990e27f0cb185310df163b3278faf267e87d12bf84b
broadcast HELLOWORLD txid.(837c132ab47f1ac1eee2e03828a9818369b919c1de128b99958ac95ffdc96551)
KMD ht.1023336 &lt;- 689d0f0006a53215d5a07d9ee1c9206dcdccacd1c364968b555c56cdf78f9f0c40f87d08b30fdf63299d25bd9a09a3b3fb8a26800a0a4f6e93ca6cd8cb41b98b756dd937
broadcast HELLOWORLD txid.(f33d5ffaec7d13f14605556cee86262299db8fad0337d1baefadc59ec24b6055)
</code></pre></div><p>If the oracle is working as expected, a response similar to the one in the right column of the web browser following should occur:</p> <h3 id="examples-8"><a href="#examples-8" aria-hidden="true" class="header-anchor">#</a> Examples:</h3> <h2 id="using-the-gateway"><a href="#using-the-gateway" aria-hidden="true" class="header-anchor">#</a> Using the Gateway</h2> <h3 id="gatewaysdeposit"><a href="#gatewaysdeposit" aria-hidden="true" class="header-anchor">#</a> <code>gatewaysdeposit</code></h3> <p>You will need the <strong>gatewaysDepositAddress</strong>. This is the address where you should deposit your KMD on the main KMD chain.</p> <p><code>./komodo-cli -ac_name=HELLOWORLD gatewaysinfo BINDTXID</code></p> <p>Save the returned transaction id for later use.</p> <p>To make a deposit to the gateway, thereby locking external coins in exchange for on-chain tokens, use the <code>z_sendmany</code> call to send funds both to the gatewaysDepositAddress on the KMD chain, and also a small amount of funds to the address corresponding to the <code>pubkey</code> where you want to receive the tokenized KMD to appear on the <code>HELLOWORLD</code> chain:</p> <p><code>./komodo-cli z_sendmany &quot;SENDINGADDRESS&quot; '[{&quot;address&quot;:&quot;addressOfPubkeyYouWantTokenizedKmdAppearIn&quot;,&quot;amount&quot;:0.0001},{&quot;address&quot;:&quot;gatewaysDepositAddress&quot;,&quot;amount&quot;:0.1}]'</code></p> <p>The returned transaction id is our <strong>cointxid</strong>.</p> <p>This transaction should have two <code>vouts</code> (i.e. two addresses declared as recepients), and change.</p> <p>Now you should have enough data to proceed with the <a href="#gatewaysdeposit"><code>gatewaysdeposit</code></a> call. This method broadcasts data about the KMD deposit on the asset chain, allowing for the nodes to validate the actions:</p> <p><code>./komodo-cli gatewaysdeposit BINDTXID HEIGHT COIN COINTXID CLAIMVOUT DEPOSITHEX PROOF DESTPUB AMOUNT</code></p> <p><code>BINDTXID</code>: the bindtxid from earlier
<code>HEIGHT</code>: the block height of the <code>txid</code> returned from the <code>z_sendmany</code> command
<code>COIN</code>: the KMD desired for this example
<code>COINTXID</code>: the txid returned from <code>z_sendmany</code> <code>CLAIMVOUT</code>: the <code>vout</code> of the claim (on the first use, this value should be 0)
<code>DEPOSITHEX</code>: returned from the txid of <code>z_sendmany</code> <code>PROOF</code>: can be found using, `./komodo-cli gettxoutproof '[&quot;&lt;txid of z_sendmany<strong>gatewaysDepositAddress</strong>. This is the address where you should deposit your KMD on the main KMD chain.</p> <p><code>./komodo-cli -ac_name=HELLOWORLD gatewaysinfo BINDTXID</code></p> <p>Save the returned transaction id for later use.</p> <p>To make a deposit to the gateway, thereby locking external coins in exchange for on-chain tokens, use the <code>z_sendmany</code> call to send funds both to the gatewaysDepositAddress on the KMD chain, and also a small amount of funds to the address corresponding to the <code>pubkey</code> where you want to receive the tokenized KMD to appear on the <code>HELLOWORLD</code> chain:</p> <p><code>./komodo-cli z_sendmany &quot;SENDINGADDRESS&quot; '[{&quot;address&quot;:&quot;addressOfPubkeyYouWantTokenizedKmdAppearIn&quot;,&quot;amount&quot;:0.0001},{&quot;address&quot;:&quot;gatewaysDepositAddress&quot;,&quot;amount&quot;:0.1}]'</code></p> <p>The returned transaction id is our <strong>cointxid</strong>.</p> <p>This transaction should have two <code>vouts</code> (i.e. two addresses declared as recepients), and change.</p> <p>Now you should have enough data to proceed with the <a href="#gatewaysdeposit"><code>gatewaysdeposit</code></a> call. This method broadcasts data about the KMD deposit on the asset chain, allowing for the nodes to validate the actions:</p> <p><code>./komodo-cli gatewaysdeposit BINDTXID HEIGHT COIN COINTXID CLAIMVOUT DEPOSITHEX PROOF DESTPUB AMOUNT</code></p> <p><code>BINDTXID</code>: the bindtxid from earlier
<code>HEIGHT</code>: the block height of the <code>txid</code> returned from the <code>z_sendmany</code> command
<code>COIN</code>: the KMD desired for this example
<code>COINTXID</code>: the txid returned from <code>z_sendmany</code> <code>CLAIMVOUT</code>: the <code>vout</code> of the claim (on the first use, this value should be 0)
<code>DEPOSITHEX</code>: returned from the txid of <code>z_sendmany</code> <code>PROOF</code>: can be found using, <code>./komodo-cli gettxoutproof '[&quot;&lt;txid of z_sendmany&gt;&quot;]'</code> <code>DESTPUB</code>: the public key where these tokens should be received on the asset chain
<code>AMOUNT</code>: the amount for the deposit (in this case 0.1)</p> <p>Broadcast the returned HEX data:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD sendrawtransaction HEX_DATA_HERE</code></p> <p>The transaction id obtained for the above command will be called the <strong>deposittxid</strong></p> <p>Please note that for the deposit to process successfully, the needed height must be successfully process through the oracle, using the oraclefeed dApp</p> <h3 id="gatewaysclaim"><a href="#gatewaysclaim" aria-hidden="true" class="header-anchor">#</a> <code>gatewaysclaim</code></h3> <p>The next steps are to spend the marker and deposit asset, and to perform the claim which will actually credit asset tokens to the depositor.</p> <p>This call can only be performed by the owner of the <code>privkey</code> corresponding to the pubkey which was used in the <code>gatewaysdeposit</code> call. This is the <code>-pubkey=$PUBKEY</code> parameter used to launch the daemon.</p> <p><code>./komodo-cli -ac_name=HELLOWORLD gatewaysclaim BINDTXID COIN DEPOSITTXID DESTPUB AMOUNT</code></p> <p><code>BINDTXID</code>: the bindtxid from earlier
<code>COIN</code>: the KMD desired for this example
<code>DEPOSITTXID</code>: the transaction id returned from the <code>gatewaysdeposit</code>call
<code>DESTPUB</code>: the public key where these tokens should be received on the asset chain
<code>AMOUNT</code>: the amount for the deposit (in this case 0.1)</p> <p>Broadcast the returned HEX value:</p> <p><code>./komodo-cli -ac_name=HELLOWORLD sendrawtransaction HEX_DATA_HERE</code></p> <p>Once this transaction is successfully confirmed, tokens should be credited to the indicated pubkey. These tokens are now usable as regular TokenCC tokens.</p> <h3 id="gatewayswithdraw"><a href="#gatewayswithdraw" aria-hidden="true" class="header-anchor">#</a> <code>gatewayswithdraw</code></h3> <p>The <code>gatewayswithdraw</code> call can be done by anyone in posession of the KMD tokens.</p> <p>First, we must convert these tokens back to their non-bound form using <code>tokenconvert</code>:</p> <p><code>./komodo-cli -ac_name=ORCL tokenconvert 241 TOKENID PUBKEY TOTAL_SUPPLY</code></p> <p><code>PUBKEY</code>: the pubkey on which tokens should be availiable after conversion (this pubkey is the <code>-pubkey=</code> parameter used to launch the daemon)</p> <p>Please bear in mind that oracle dApp must be running for the <code>gatewayswithdraw</code> method to work.</p> <p>After the <code>tokenconvert</code> transaction is confirmed, you can call the <code>gatewayswithdraw</code> rpc from the node that owns the <code>pubkey</code> used in <code>tokenconvert</code>.</p> <p>Before executing <code>gatewayswithdraw</code>, import the private key for the <code>gatewaysdeposit</code> address. This is the address on the asset chain for which you are operating the gateway. Also, this should be on the same node that is running the oracle dApp.</p> <p>Retrieve the following information:</p> <ul><li><p>The <strong>gatewayDepositAddress</strong> from the &quot;deposit&quot; field returned from this command:</p> <ul><li><code>./komodo-cli -ac_name=HELLOWORLD gatewaysinfo BINDTXID</code></li></ul></li> <li><p>The private key returned from this command:</p> <ul><li><code>./komodo-cli -ac_name=HELLOWORLD dumprivkey gatewayDepositAddress</code></li></ul></li></ul> <p>Execute the following commands on the node running the oracle dApp:</p> <p><code>./komodo-cli importprivkey &lt;private key&gt;</code></p> <p><code>./komodo-cli -ac_name=HELLOWORLD gatewayswithdraw BINDTXID COIN WITHDRAWPUB AMOUNT</code></p> <p><code>BINDTXID</code>: the bindtxid from earlier
<code>COIN</code>: the KMD desired for this example
<code>WITHDRAWPUB</code>: the pubkey where the withdrawn coins should appear on the external chain (in this case, the KMD pubkey)
<code>AMOUNT</code>: the amount for the deposit (in this case 0.1)</p> <p>This should complete the withdrawal process, and therefore the cycle for the <code>gateways</code> contract.</p> <h3 id="examples-9"><a href="#examples-9" aria-hidden="true" class="header-anchor">#</a> Examples:</h3></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/komodo-docs-vuepress/010-cryptoconditions/_130-cc-faucet.html" class="prev">
          Faucet
        </a></span> <span class="next"><a href="/komodo-docs-vuepress/010-cryptoconditions/_135-cc-oracles.html">
          Oracles
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/komodo-docs-vuepress/assets/js/14.0559a178.js" defer></script><script src="/komodo-docs-vuepress/assets/js/app.98eba040.js" defer></script>
  </body>
</html>
